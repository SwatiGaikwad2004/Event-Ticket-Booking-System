{% extends 'base.html' %}

{% block content %}

{% if messages %}
  {% for message in messages %}
    <p style="color: lightgreen; text-align: center;">{{ message }}</p>
  {% endfor %}
{% endif %}

<div style="max-width: 700px; margin: auto; padding: 30px; background: rgba(30, 30, 30, 0.85); border-radius: 10px; box-shadow: 0 0 15px rgba(255,255,255,0.05); color: #e0e0e0;">
  <h2 style="text-align: center; color: #f2f2f2;">{{ event.title }}</h2>
  <p><strong>Description:</strong> {{ event.description }}</p>
  <p><strong>Date:</strong> {{ event.date }}</p>
  <p><strong>Location:</strong> {{ event.location }}</p>
  <p><strong>Seats Available:</strong> {{ available_seats }}</p>

  {% if user.is_authenticated %}
      {% if user_has_booked %}
          <p style="color: lightgreen;"><strong>You have successfully booked this event.</strong></p>
      {% elif available_seats > 0 %}
          <form method="post" action="{% url 'book_ticket' event.id %}" style="text-align: center; margin-top: 20px;">
              {% csrf_token %}
              <button type="submit" style="padding: 10px 20px; background-color: #4B9CD3; color: white; border: none; border-radius: 6px; cursor: pointer;">Book Ticket</button>
          </form>
      {% else %}
          <p style="color: #ff4d4d;"><strong>Sorry, this event is fully booked.</strong></p>
      {% endif %}
  {% else %}
      <p>Please <a href="{% url 'login' %}?next={{ request.path }}" style="color: #00bfff;">login</a> to book tickets.</p>
  {% endif %}
</div>

<hr style="margin: 40px 0; border-top: 1px solid #444;">

<div style="max-width: 700px; margin: auto; padding: 20px;">
  <h3 style="color: #ddd;">Leave a Review</h3>
  {% if user.is_authenticated %}
      <form method="post" style="background: rgba(40, 40, 40, 0.9); padding: 20px; border-radius: 8px; box-shadow: 0 0 5px rgba(255,255,255,0.05); color: #f5f5f5;">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit" style="margin-top: 10px; background-color: #27ae60; color: white; padding: 10px 16px; border: none; border-radius: 6px;">Submit Review</button>
      </form>
  {% else %}
      <p>Please <a href="{% url 'login' %}?next={{ request.path }}" style="color: #00bfff;">login</a> to leave a review.</p>
  {% endif %}
</div>

<hr style="margin: 40px 0; border-top: 1px solid #444;">

<div style="max-width: 700px; margin: auto;">
  <h3 style="color: #ddd;">Reviews</h3>
  {% for review in reviews %}
      <div style="border-left: 5px solid #4B9CD3; padding: 10px 15px; margin: 15px 0; background-color: rgba(50, 50, 50, 0.8); box-shadow: 0 0 4px rgba(255,255,255,0.03); border-radius: 6px; color: #eee;">
          <strong>{{ review.user.username }}</strong> — {{ review.rating }}★<br>
          <p style="margin: 8px 0;">{{ review.comment }}</p>
          <small style="color: #aaa;">{{ review.created_at }}</small>
      </div>
  {% empty %}
      <p style="text-align: center; color: #888;">No reviews yet.</p>
  {% endfor %}
</div>

{% endblock %}
